# FlClash 代理功能测试套件

## 概述

本测试套件为FlClash代理功能提供了全面的测试覆盖，包括代理连接、浏览器流量路由、流量监控、代理验证和集成测试。

## 文件结构

### 1. 代理功能测试 (`code/test/proxy_functionality_test.dart`)
- **功能**: 测试代理服务的基本功能
- **测试内容**:
  - HTTP/HTTPS/SOCKS5代理连接测试
  - 代理认证测试（Basic认证）
  - 代理断开和重连机制
  - 代理配置序列化/反序列化
  - 并发代理连接测试
  - 代理连接性能基准测试
  - 代理事件流测试

### 2. 浏览器流量测试 (`code/test/browser_traffic_test.dart`)
- **功能**: 测试浏览器流量是否正确通过FlClash代理
- **测试内容**:
  - 基本HTTP/HTTPS请求流量监控
  - 代理流量路由验证
  - 自定义请求头测试
  - 域名统计和流量分析
  - 错误流量记录
  - 流量事件流测试
  - 并发请求处理测试
  - 响应状态码验证
  - 内容类型检测
  - 流量监控性能测试

### 3. 流量监控服务 (`code/services/traffic_monitor.dart`)
- **功能**: 提供实时网络流量监控和分析
- **主要特性**:
  - 实时流量数据记录
  - 流量统计和分析
  - 带宽使用监控
  - 并发连接数统计
  - 域名流量分析
  - 流量数据导出
  - 域名黑名单支持
  - 带宽限制控制
  - 流量加密支持
  - 详细的流量报告生成

### 4. 代理验证工具 (`code/utils/proxy_validator.dart`)
- **功能**: 验证代理配置的正确性和性能
- **验证内容**:
  - 代理连接测试
  - 性能指标测试（延迟、速度、吞吐量）
  - 安全指标测试（加密、SSL验证、匿名级别）
  - 泄露测试（DNS、WebRTC、IP泄露）
  - 批量代理验证
  - 最佳代理选择
  - 详细验证报告生成

### 5. 集成测试 (`code/test/integration_test.dart`)
- **功能**: 整合所有代理功能进行端到端测试
- **测试场景**:
  - 代理功能集成测试
  - 浏览器流量路由集成测试
  - 流量监控集成测试
  - 代理验证集成测试
  - 端到端代理流程测试
  - 性能基准测试
  - 安全验证测试
  - 并发处理测试
  - 错误处理测试
  - 资源清理测试

## 技术特性

### 测试框架
- 使用Flutter的`flutter_test`包
- 集成`mockito`进行模拟测试
- 支持异步测试和并发测试
- 提供详细的测试报告

### 模拟环境
- 模拟网络环境和代理场景
- 模拟各种代理协议（HTTP、HTTPS、SOCKS5）
- 模拟网络延迟和错误情况
- 支持性能基准测试

### 流量监控
- 实时流量数据收集
- 多维度流量分析
- 带宽使用统计
- 域名访问统计
- 流量数据导出功能

### 安全验证
- 代理匿名级别检测
- DNS泄露检测
- WebRTC泄露检测
- SSL证书验证
- 流量加密验证

### 性能测试
- 代理连接延迟测试
- 吞吐量基准测试
- 并发处理能力测试
- 内存使用监控
- 响应时间分析

## 使用方法

### 运行单个测试文件
```bash
flutter test test/proxy_functionality_test.dart
flutter test test/browser_traffic_test.dart
flutter test test/integration_test.dart
```

### 运行所有测试
```bash
flutter test
```

### 生成测试报告
```bash
flutter test --reporter expanded
```

## 测试覆盖范围

### 代理协议支持
- ✅ HTTP代理
- ✅ HTTPS代理
- ✅ SOCKS5代理

### 功能测试
- ✅ 代理连接/断开
- ✅ 代理认证
- ✅ 流量路由
- ✅ 流量监控
- ✅ 性能测试
- ✅ 安全验证

### 集成测试
- ✅ 端到端流程
- ✅ 并发处理
- ✅ 错误处理
- ✅ 资源清理

## 性能基准

### 连接性能
- 平均连接延迟: < 500ms
- 最大连接延迟: < 5秒
- 并发连接数: 支持多线程

### 流量监控
- 实时数据更新: 1秒间隔
- 最大日志条目: 10,000条
- 数据保留时间: 24小时

### 验证性能
- 单个代理验证: < 10秒
- 批量代理验证: 支持并发
- 性能指标精度: 毫秒级

## 安全特性

### 流量加密
- 支持HTTPS代理加密
- 流量数据加密存储
- 敏感信息保护

### 泄露防护
- DNS泄露检测
- WebRTC泄露检测
- IP地址隐藏验证

### 访问控制
- 域名黑名单支持
- 带宽限制控制
- 流量配额管理

## 扩展性

### 自定义测试
- 支持添加新的测试用例
- 可配置测试参数
- 支持自定义验证规则

### 监控扩展
- 可扩展流量数据类型
- 支持自定义统计指标
- 可集成外部监控系统

### 验证扩展
- 支持新的代理协议
- 可添加安全检查项
- 支持自定义验证规则

## 注意事项

1. **网络环境**: 测试需要稳定的网络环境，某些测试在离线模式下可能失败
2. **代理服务器**: 需要有效的代理服务器配置才能进行完整测试
3. **性能测试**: 性能基准测试结果可能因网络环境而异
4. **安全测试**: 安全验证测试需要特定的测试环境

## 维护和更新

- 定期更新测试用例以适应新的代理协议
- 根据实际使用情况调整性能基准
- 持续改进安全验证机制
- 优化测试执行效率

## 贡献指南

1. 新增测试用例需要遵循现有测试模式
2. 性能基准测试需要提供合理的阈值
3. 安全测试需要经过充分验证
4. 所有测试需要提供详细的文档说明

---

*本测试套件为FlClash代理功能提供了全面的质量保证，确保代理服务的稳定性、安全性和性能。*